#summary This page informs on installing/using Smallapack on Squeak/Pharo
#labels Phase-Deploy

= Introduction =

Installing Smallapack on Squeak and Pharo is not fully automated. Some information about packages to load and load order are necessary.


= Details =

All code can be found on http://www.squeaksource.com/Smallapack.html and is loadable via Monticello tool. But there are a few tricks:

*The problem of FFI calls with 15 arguments*

 Some LAPACK functions have more than 15 arguments, while Squeak/Pharo currently do not support invoking a Smalltalk method with more than 15 arguments. However, FFI can invoke a function with more than 15 arguments by simply passing an Array. It would have been possible to reify the external procedure, forming an Array of arguments and explicitely invoking the procedure object with the array of arguments, but that would have lead to even more unreadable and bad code. Instead, a trick has been implemented on Squeak/Pharo to let the compiler perform this single Array argument trick transparently when it encounters a method with 16 args or more. A Compiler version can be found in Squeaksource with ad hoc changes.

*The presence of Complex and required extensions*

 Squeak contains a Complex class. But this class lacks a few methods. These can be found in http://www.squeaksource.com/NumberExtensions.html and http://www.squeaksource.com/ComplexExtensions.html - but the version must be chosen based in Squeak version (I recommend using Squeak trunk >= 4.3). Pharo does not provide a Complex class, so you might pick the one in Squeak and import it in Pharo first.

*The Smallapack packages*

 The Smallapack packages may have load order problems too. I generally load with the following order:
  * Smallapack-Collection
  * Smallapack-External
  * Smallapack-Algorithm
  * Smallapack-Matrix
  * Smallapack-SUnitTests

 You may have to replay manually some LapackMatrix initializations, handling how Monticello works with this respect is not a pleasure.

 The package Smallapack-Builder is not mandatory. it is just a helper that helps generating Smallapack-External from comments in LAPACK source

*The BLAS/LAPACK libraries*

 Some dynamic libraries must be provided [SmallapackPrerequisistes]. They must be found on the path used by Squeak FFI (I generally put the DLL in the same directory as the squeak .image). And their name must be matching the Smalltalk declaration in #moduleName (you'll have to adapt one or the other).